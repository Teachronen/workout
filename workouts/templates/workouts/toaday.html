<!doctype html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Today's Workout</title>
    <style>
      body { font-family: Arial, sans-serif; margin: 24px; }
      .top { display: flex; justify-content: space-between; align-items: center; }
      .card { border: 1px solid #ddd; border-radius: 10px; padding: 16px; margin: 16px 0; }
      .muted { color: #666; font-size: 0.95em; }
      input[type="number"] { width: 90px; padding: 6px; }
      input[type="text"] { width: 320px; padding: 6px; }
      textarea { width: 100%; padding: 8px; }
      .row { display: flex; gap: 12px; align-items: center; margin: 8px 0; flex-wrap: wrap; }
      .btn { padding: 10px 14px; border: 0; border-radius: 8px; cursor: pointer; }
      .btn-primary { background: #111; color: #fff; }
      .msg { padding: 10px 12px; border-radius: 8px; margin: 10px 0; }
      .msg-success { background: #e8fff1; border: 1px solid #b6f0c8; }
      .msg-error { background: #fff0f0; border: 1px solid #f2b9b9; }
      a { color: #0b57d0; }
    </style>
  </head>
  <body>
    <div class="top">
      <div>
        <h1>Today's Workout</h1>
        <div class="muted">{{ today }}</div>
      </div>
      <div>
        <span class="muted">Logged in as <strong>{{ request.user.username }}</strong></span>
        &nbsp;|&nbsp;
        <a href="/accounts/logout/">Logout</a>
      </div>
    </div>

    {% if messages %}
      {% for message in messages %}
        <div class="msg {% if message.tags == 'success' %}msg-success{% else %}msg-error{% endif %}">
          {{ message }}
        </div>
      {% endfor %}
    {% endif %}

    {% if not plan %}
      <div class="card">
        <h2>No workout planned for today</h2>
        <p class="muted">Ask the admin to create a WorkoutPlan for {{ today }}.</p>
      </div>
    {% else %}
      <div class="card">
        <h2>{{ plan.title|default:"Workout" }}</h2>
        <p class="muted">
          This page saves reps/time as whole numbers. For timed holds, enter seconds (e.g., 60).
        </p>
      </div>

      <form method="post">
        {% csrf_token %}

        {% for item in items %}
          <div class="card">
            <h3>{{ item.order }}. {{ item.exercise.name }}</h3>

            <div class="row">
              <div><strong>Sets:</strong> {{ item.prescribed_sets }}</div>
              <div><strong>Target:</strong> {{ item.prescribed_reps }}</div>
              <div><strong>Rest:</strong> {{ item.rest_seconds }}s</div>
              <div>
                <a href="{{ item.exercise.youtube_url }}" target="_blank" rel="noopener noreferrer">
                  YouTube demo
                </a>
              </div>
            </div>

            {% for set_num in "123456789"|slice:":item.prescribed_sets" %}
              <div class="row">
                <div><strong>Set {{ forloop.counter }}:</strong></div>
                <div>
                  <label>
                    Reps/Seconds:
                    <input
                      type="number"
                      name="reps_{{ item.id }}_{{ forloop.counter }}"
                      value=""

                    />
                  </label>
                </div>
                <div>
                  <label>
                    Comment:
                    <input
                      type="text"
                      name="comment_{{ item.id }}_{{ forloop.counter }}"
                     value=""
                      placeholder="optional"
                    />
                  </label>
                </div>
              </div>
            {% endfor %}
          </div>
        {% endfor %}

        <div class="card">
          <h3>General comment</h3>
          <textarea name="general_comment" rows="3" placeholder="How did it feel today?">{{ log.general_comment }}</textarea>
        </div>

        <button class="btn btn-primary" type="submit">Save workout</button>
      </form>
    {% endif %}
  </body>
</html>
